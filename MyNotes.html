<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Final//EN">
<html>
    <head>
        <title> MyNotes </title>
        <style type="text/css">
            .h1 {
                font-family: "Century gothic", Mistral;
                font-size: 16pt;
                color: #330033;
                margin: 5% 20%;
            }

            .note-container {
                margin: 5% 0%;
                width: 100%;
            }

            .note-container textarea {
                padding: 10px;
                background-color: #CC9999;
                color: #330033;
                font-family: "Century gothic", Mistral;
                font-size: 12pt;
                box-shadow: 0 0 20px rgba(0,0,0,0.5);
                width: 100%;
            }

            .date {
                color: #999999;
                font-family: "Century gothic", Mistral;
                font-size: 8pt;
                text-align: right;
            }

        </style>
    </head>
    <body bgcolor="FFFFCC">
        <div class="h1">
            Enter your note...
            <textarea id="newNoteInput" name="text" style="width: 100%; padding: 10px;"></textarea>
            <input id="addButton" type="button" value="Save">
        </div>

        <div id="notesList" style="margin: 0% 20%;">
        </div>

        <script type="text/javascript">
            var notes          = [];  //массив с заметками
            var notesList      = document.getElementById('notesList'); //найти див для расположения заметок
            var newNoteInput   = document.getElementById('newNoteInput'); // найти текстареа для ввода текста новой заметки

            fetch('http://localhost:3000/notes').then(
                function(response) {
                    if (response.status !== 200) {
                        console.log('Looks like there was a problem. Status Code: ' +  response.status);
                        return;
                    }

                    response.json().then(function(resivedFromServerNotes) {
                        for (var i = 0; i < resivedFromServerNotes.count; i++) {
                            var resivedFromServerNote  = resivedFromServerNotes.data[i];
                            resivedFromServerNote.date = new Date(resivedFromServerNote.date);
                            var newNoteContainer       = showNote(resivedFromServerNote); //создание дива с текстом и датой заметки из массива
                            notesList.appendChild(newNoteContainer);
                        }; //цикл который запихивает заметки из массива в дивы
                        notes = notes.concat(resivedFromServerNotes.data);
                        console.log(notes);
                    });
                }
            ).catch(function(error) {
                console.log('Fetch Error :-S', error);
            });

            document.getElementById('addButton').onclick = function() {
                var note = {
                    text: newNoteInput.value,
                    date: new Date()
                };

                fetch('http://localhost:3000/notes', {
                    method: 'post',
                    headers: { "Content-type": "application/json; charset=UTF-8" },
                    body: JSON.stringify(note)
                }).then(
                    function(response){
                        response.json().then(function(resivedFromServerStatus) {
                            console.log(resivedFromServerStatus);
                        })
                    }
                );

                var newNoteContainer = showNote(note); //создание дива с текстом и датой только что введенной заметки
                notesList.insertBefore(newNoteContainer, notesList.firstChild); //1 аргумент - что вставлять, 2ой - куда
                notes.push(note); //впихивание нового объекта в массив
            };

            function dateFormat(date) {
                return date.getDate()       + "."  +
                       (date.getMonth() +1) + "."  +
                       date.getFullYear()   + ", " +
                       date.getHours()      + ":"  +
                       date.getMinutes()    + ":"  +
                       date.getSeconds();
            }

            function showNote(note) {
                var newNoteContainer  = document.createElement('div'); //создание нового дива в виде объекта
                var newTextArea       = document.createElement('textarea');
                var newDateContainer  = document.createElement('div');

                newNoteContainer.appendChild(newTextArea);
                newNoteContainer.appendChild(newDateContainer);
                newNoteContainer.className = 'note-container'; //свойства объекта
                newDateContainer.className = "date";
                newTextArea.innerHTML      = note.text; //свойствo объекта
                newDateContainer.innerHTML = dateFormat(note.date);

                return newNoteContainer;
            }

        </script>
    </body>
</html>